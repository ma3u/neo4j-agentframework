# Neo4j Production Configuration for RAG System
# Optimized for high-performance vector search and large datasets

#*****************************************************************
# Memory Configuration
#*****************************************************************

# JVM Heap memory allocation
dbms.memory.heap.initial_size=2g
dbms.memory.heap.max_size=4g

# Page cache for better I/O performance
dbms.memory.pagecache.size=2g

# Off-heap transaction state cache
dbms.tx_state.memory_allocation=ON_HEAP

#*****************************************************************
# Connection and Threading
#*****************************************************************

# Bolt connector thread pool configuration
dbms.connector.bolt.thread_pool_min_size=5
dbms.connector.bolt.thread_pool_max_size=400
dbms.connector.bolt.thread_pool_keep_alive=5m

# Connection timeout settings
dbms.connector.bolt.connection_keep_alive=30s
dbms.transaction.timeout=60s

#*****************************************************************
# Query Performance
#*****************************************************************

# Query execution plan caching
dbms.query_cache_size=1000

# Cypher runtime selection (use PIPELINED for better performance)
cypher.default_runtime=pipelined

# Index sampling for better query planning
dbms.index_sampling.background_enabled=true
dbms.index_sampling.sample_size_limit=1000000

#*****************************************************************
# Logging and Monitoring
#*****************************************************************

# Query logging for performance analysis
dbms.logs.query.enabled=INFO
dbms.logs.query.threshold=1000ms
dbms.logs.query.parameter_logging_enabled=true

# Security event logging
dbms.logs.security.level=INFO

# Metrics configuration
metrics.enabled=true
metrics.csv.enabled=true
metrics.csv.interval=30s

#*****************************************************************
# Transaction Configuration
#*****************************************************************

# Maximum concurrent transactions
dbms.transaction.concurrent.maximum=1000

# Transaction state memory threshold
dbms.tx_state.max_off_heap_memory=2g

#*****************************************************************
# Security Configuration
#*****************************************************************

# Enable APOC procedures for advanced operations
dbms.security.procedures.unrestricted=apoc.*,gds.*

# Allow unsafe procedures (needed for some vector operations)
dbms.security.procedures.allowlist=apoc.*,gds.*

#*****************************************************************
# Vector Search Optimizations
#*****************************************************************

# Enable parallel execution for better vector search performance
cypher.parallel.minimum_graph_size=100000
cypher.parallel.runtime.worker_limit=4

# Index provider configuration
dbms.index.default_schema_provider=range-1.0
dbms.index.fulltext.default_analyzer=standard-no-stop-words

#*****************************************************************
# Network Configuration
#*****************************************************************

# Increase network buffer sizes for better throughput
dbms.connector.bolt.listen_address=0.0.0.0:7687
dbms.connector.http.listen_address=0.0.0.0:7474

# Enable compression for better network performance
dbms.connector.bolt.enabled=true
dbms.connector.http.enabled=true

#*****************************************************************
# Backup and Maintenance
#*****************************************************************

# Enable online backup
dbms.backup.enabled=true
dbms.backup.listen_address=0.0.0.0:6362

# Checkpoint configuration for better write performance  
dbms.checkpoint.interval.time=15m
dbms.checkpoint.interval.tx=100000

#*****************************************************************
# Development vs Production Settings
#*****************************************************************

# Set to false in production for better performance
dbms.logs.debug.enabled=false

# Disable usage data collection in production
dbms.usage_report.enabled=false